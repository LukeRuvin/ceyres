"use strict";(self.webpackChunkuzmart=self.webpackChunkuzmart||[]).push([[7598],{27276:(e,l,t)=>{t.d(l,{v:()=>s});var i=t(9950),a=t(90777),n=t(90650),r=t(44414);const s=e=>{let{fetchOptions:l,refetch:t=!1,...s}=e;const[d,o]=(0,i.useState)(!1),[u,c]=(0,i.useState)([]);return(0,r.jsx)(a.A,{treeLine:!0,treeData:d?[]:u,treeDefaultExpandAll:!0,labelInValue:!0,onFocus:()=>{u.length&&!t||(o(!0),l().then((e=>{c(e),o(!1)})))},notFoundContent:d?(0,r.jsx)(n.A,{size:"small"}):"no results",...s})}},87598:(e,l,t)=>{t.r(l),t.d(l,{default:()=>P});var i=t(9950),a=t(59233),n=t(23263),r=t(87094),s=t(41988),d=t(55902),o=t(99674),u=t(40577),c=t(25933),m=t(48538),v=t(90650),p=t(85923),h=t(28429),g=t(71999),j=t(98591),y=t(91854),x=t(74623),A=t(62572),b=t(63620),f=t(70030),w=t(48970),k=t(28264),I=t(27276),E=t(44414);const P=()=>{var e,l;const{t:t}=(0,f.B)(),P=(0,h.Zp)(),_=(0,y.wA)(),[S,q]=(0,i.useState)("main"),[F,N]=(0,i.useState)(!1),{activeMenu:$}=(0,y.d4)((e=>e.menu),y.bN),{state:z}=(0,h.zy)(),[L,V]=(0,i.useState)(!1),[C,O]=(0,i.useState)(null!==(e=$.data)&&void 0!==e&&e.image?[null===(l=$.data)||void 0===l?void 0:l.image]:[]),[B]=a.A.useForm(),[D,M]=(0,i.useState)(!1),[K,R]=(0,i.useState)(null),{uuid:T}=(0,h.g)(),{params:U}=(0,y.d4)((e=>e.category),y.bN),{defaultLang:Z,languages:G}=(0,y.d4)((e=>e.formLang),y.bN);(0,i.useEffect)((()=>()=>{const e=B.getFieldsValue(!0);_((0,x.Ok)({activeMenu:$,data:e})),_((0,k.jE)({...U,type:S,parent_id:null===z||void 0===z?void 0:z.parentId}))}),[]);const H=e=>({name:e,url:b.sE+e});function J(e){if(!e)return{};const{translations:l}=e,t=G.map((e=>{var t,i;return{[`title[${e.locale}]`]:null===(t=l.find((l=>l.locale===e.locale)))||void 0===t?void 0:t.title,[`description[${e.locale}]`]:null===(i=l.find((l=>l.locale===e.locale)))||void 0===i?void 0:i.description}}));return Object.assign({},...t)}(0,i.useEffect)((()=>{var e;e=T,V(!0),A.A.getById(e).then((e=>{var l,t,i,a;let n=e.data;const r={...n,...J(n),input:(null===n||void 0===n?void 0:n.input)||0,image:[H(n.img)],keywords:null===n||void 0===n||null===(l=n.keywords)||void 0===l?void 0:l.split(","),parent_id:{label:null===(t=n.parent)||void 0===t||null===(i=t.translation)||void 0===i?void 0:i.title,value:n.parent_id,key:n.parent_id}};q(null===n||void 0===n?void 0:n.type),B.setFieldsValue(r),O([H(n.img)]),(null===n||void 0===n||null===(a=n.children)||void 0===a?void 0:a.length)>0&&"main"===(null===n||void 0===n?void 0:n.type)&&N(!0)})).finally((()=>{V(!1),_((0,x.km)($))}))}),[$.refetch,T,null===z||void 0===z?void 0:z.parentId]);return(0,E.jsx)(E.Fragment,{children:(0,E.jsx)(n.A,{title:null!==z&&void 0!==z&&z.parentId?t("edit.sub.category"):t("edit.category"),extra:(0,E.jsx)(g.A,{}),children:L?(0,E.jsx)("div",{className:"d-flex justify-content-center align-items-center py-5",children:(0,E.jsx)(v.A,{size:"large",className:"mt-5 pt-5"})}):(0,E.jsxs)(a.A,{name:"basic",layout:"vertical",onFinish:e=>{var l,i,a;M(!0);const n={...e,type:null!==(l=e.parent_id)&&void 0!==l&&l.value?S:"main",active:e.active?1:0,keywords:e.keywords.join(","),parent_id:null===(i=e.parent_id)||void 0===i?void 0:i.value,"images[0]":null===(a=C[0])||void 0===a?void 0:a.name},r="catalog/categories";A.A.update(T,n).then((()=>{p.oR.success(t("successfully.updated")),_((0,x.EK)({...$,nextUrl:r})),P(`/${r}`)})).catch((e=>R(e.response.data.params))).finally((()=>M(!1)))},initialValues:{active:!0,...$.data},form:B,children:[(0,E.jsxs)(r.A,{gutter:12,children:[(0,E.jsx)(s.A,{span:12,children:G.map(((e,l)=>(0,E.jsx)(a.A.Item,{label:t("name"),name:`title[${e.locale}]`,help:K&&K[`title.${Z}`]?K[`title.${Z}`][0]:null,validateStatus:K?"error":"success",rules:[{validator:(l,i)=>i||(null===e||void 0===e?void 0:e.locale)!==Z?i&&""===(null===i||void 0===i?void 0:i.trim())?Promise.reject(new Error(t("no.empty.space"))):i&&(null===i||void 0===i?void 0:i.trim().length)<2?Promise.reject(new Error(t("must.be.at.least.2"))):Promise.resolve():Promise.reject(new Error(t("required")))}],hidden:e.locale!==Z,children:(0,E.jsx)(d.A,{})},e.title+l)))}),(0,E.jsx)(s.A,{span:12,children:G.map(((e,l)=>(0,E.jsx)(a.A.Item,{label:t("description"),name:`description[${e.locale}]`,rules:[{validator:(l,i)=>i||(null===e||void 0===e?void 0:e.locale)!==Z?i&&""===(null===i||void 0===i?void 0:i.trim())?Promise.reject(new Error(t("no.empty.space"))):i&&(null===i||void 0===i?void 0:i.trim().length)<5?Promise.reject(new Error(t("must.be.at.least.5"))):Promise.resolve():Promise.reject(new Error(t("required")))}],hidden:e.locale!==Z,children:(0,E.jsx)(j.A,{rows:4})},e.locale+l)))}),(0,E.jsx)(s.A,{span:12,children:(0,E.jsx)(a.A.Item,{label:t("keywords"),name:"keywords",rules:[{required:!0,message:t("required")}],children:(0,E.jsx)(o.A,{mode:"tags",style:{width:"100%"}})})}),(0,E.jsx)(s.A,{span:12,children:(0,E.jsx)(a.A.Item,{label:t("parent.category"),name:"parent_id",rules:[{required:!1,message:t("required")}],children:(0,E.jsx)(I.v,{fetchOptions:async function(){const{id:e}=B.getFieldValue();return A.A.getAll({perPage:100,type:"main"}).then((l=>l.data.filter((l=>l.id!==e)).map((l=>{var t,i;return{label:null===(t=l.translation)||void 0===t?void 0:t.title,value:l.id,key:l.id,type:"main",children:null===(i=l.children)||void 0===i?void 0:i.map((l=>{var t,i;return{label:null===(t=l.translation)||void 0===t?void 0:t.title,value:l.id,key:l.id,type:"sub_main",disabled:l.id===e,children:null===(i=l.children)||void 0===i?void 0:i.map((e=>{var l;return{label:null===(l=e.translation)||void 0===l?void 0:l.title,value:e.id,key:e.id,disabled:!0,type:"child"}}))}}))}}))))},onSelect:(e,l)=>{const{type:t}=l||{};q("main"===t?"sub_main":"sub_main"===t?"child":"main")},allowClear:!0,disabled:F})})}),(0,E.jsx)(s.A,{span:12,children:(0,E.jsx)(a.A.Item,{name:"input",label:t("input"),rules:[{required:!0,message:t("required")}],children:(0,E.jsx)(u.A,{min:0,parser:e=>parseInt(e,10),max:9999999,className:"w-100"})})}),(0,E.jsx)(s.A,{span:4,children:(0,E.jsx)(a.A.Item,{label:t("image"),name:"images",rules:[{validator:()=>0===(null===C||void 0===C?void 0:C.length)?Promise.reject(new Error(t("required"))):Promise.resolve()}],children:(0,E.jsx)(w.A,{type:"categories",imageList:C,setImageList:O,form:B,multiple:!1})})}),(0,E.jsx)(s.A,{span:2,children:(0,E.jsx)(a.A.Item,{label:t("active"),name:"active",valuePropName:"checked",children:(0,E.jsx)(c.A,{})})})]}),(0,E.jsx)(m.A,{type:"primary",htmlType:"submit",loading:D,children:t("submit")})]})})})}}}]);