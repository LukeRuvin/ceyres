"use strict";(self.webpackChunkuzmart=self.webpackChunkuzmart||[]).push([[7292],{7292:(e,l,t)=>{t.r(l),t.d(l,{default:()=>k});var a=t(9950),s=t(28429),i=t(85923),n=t(59233),d=t(23263),r=t(87094),o=t(41988),u=t(99674),c=t(40577),v=t(86971),m=t(48538),p=t(59051),h=t.n(p),A=t(91854),x=t(74623),f=t(35765),g=t(73439),j=t(47992),Y=t(70030),y=t(62466),b=t(48970),M=t(81446),D=t(8002),N=t(44738),q=t(44414);function k(){var e,l;const{t:t}=(0,Y.B)(),{activeMenu:p}=(0,A.d4)((e=>e.menu),A.bN),k=(0,A.wA)(),{id:S}=(0,s.g)(),[w]=n.A.useForm(),I=(0,s.Zp)(),[O,$]=(0,a.useState)(!1),[C,F]=(0,a.useState)(!1),{myShop:V}=(0,A.d4)((e=>e.myShop),A.bN),[z,E]=(0,a.useState)(null!==(e=p.data)&&void 0!==e&&e.images?[null===(l=p.data)||void 0===l?void 0:l.images[0]]:[]);(0,a.useEffect)((()=>()=>{const e=w.getFieldsValue(!0),l=JSON.stringify(e.start),t=JSON.stringify(e.end),a={...e,start:l,end:t};k((0,x.Ok)({activeMenu:p,data:a}))}),[]),(0,a.useEffect)((()=>{p.refetch&&(F(!0),f.A.getById(S).then((e=>{var l;let{data:a}=e;const s={price:a.price,type:a.type,products:null===a||void 0===a||null===(l=a.stocks)||void 0===l?void 0:l.map((e=>{var l,a,s,i;return{label:`${null===e||void 0===e||null===(l=e.product)||void 0===l||null===(a=l.translation)||void 0===a?void 0:a.title} => ${null===e||void 0===e||null===(s=e.extras)||void 0===s||null===(i=s.map((e=>{var l,a,s,i,n;return`${(null===e||void 0===e||null===(l=e.group)||void 0===l||null===(a=l.translation)||void 0===a?void 0:a.title)||t("N/A")}: ${"color"===(null===e||void 0===e||null===(s=e.group)||void 0===s?void 0:s.type)?(0,N.n)(null===e||void 0===e||null===(i=e.value)||void 0===i?void 0:i.value):(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.value)||t("N/A")}`})))||void 0===i?void 0:i.join(", ")}`,value:null===e||void 0===e?void 0:e.id,key:null===e||void 0===e?void 0:e.id}})),start:h()(a.start,"YYYY-MM-DD"),end:h()(a.end,"YYYY-MM-DD"),image:[(0,y.A)(a.img)]};w.setFieldsValue(s),E([(0,y.A)(a.img)])})).finally((()=>{F(!1),k((0,x.km)(p))})))}),[p.refetch]);return(0,q.jsx)(d.A,{title:t("edit.discount"),className:"h-100",children:C?(0,q.jsx)(M.A,{}):(0,q.jsxs)(n.A,{name:"discount-add",layout:"vertical",onFinish:e=>{var l;if(h()(e.start).format("YYYY-MM-DD")>h()(e.end).format("YYYY-MM-DD"))return i.oR.error(t("start.date.must.be.before.end.date"));const a={price:e.price,type:e.type,stocks:e.products.map((e=>e.value)),start:e.start?h()(e.start).format("YYYY-MM-DD"):void 0,end:e.end?h()(e.end).format("YYYY-MM-DD"):void 0,images:[null===(l=z[0])||void 0===l?void 0:l.name]};$(!0);const s="seller/discounts";f.A.update(S,a).then((()=>{i.oR.success(t("successfully.updated")),(0,A.vA)((()=>{k((0,x.EK)({...p,nextUrl:s})),k((0,g.X)({}))})),I(`/${s}`)})).finally((()=>$(!1)))},form:w,initialValues:{...(()=>{var e;const l=p.data;if(null===(e=p.data)||void 0===e||!e.start)return l;const t=p.data.start,a=p.data.end;return{...l,start:h()(t,"YYYY-MM-DD"),end:h()(a,"YYYY-MM-DD")}})(),...p.data},className:"d-flex flex-column h-100",children:[(0,q.jsxs)(r.A,{gutter:12,children:[(0,q.jsx)(o.A,{span:12,children:(0,q.jsx)(n.A.Item,{label:t("type"),name:"type",rules:[{required:!0,message:t("required")}],children:(0,q.jsxs)(u.A,{children:[(0,q.jsx)(u.A.Option,{value:"fix",children:t("fix")}),(0,q.jsx)(u.A.Option,{value:"percent",children:t("percent")})]})})}),(0,q.jsx)(o.A,{span:12,children:(0,q.jsx)(n.A.Item,{label:t("price"),name:"price",rules:[{required:!0,message:t("required")}],children:(0,q.jsx)(c.A,{min:0,className:"w-100"})})}),(0,q.jsx)(o.A,{span:12,children:(0,q.jsx)(n.A.Item,{label:t("start.date"),name:"start",rules:[{required:!0,message:t("required")}],valuePropName:"date",children:(0,q.jsx)(v.A,{className:"w-100",placeholder:"",disabledDate:e=>h()().add(-1,"days")>=e})})}),(0,q.jsx)(o.A,{span:12,children:(0,q.jsx)(n.A.Item,{label:t("end.date"),name:"end",rules:[{required:!0,message:t("required")}],valuePropName:"date",children:(0,q.jsx)(v.A,{className:"w-100",placeholder:"",disabledDate:e=>h()().add(-1,"days")>=e})})}),(0,q.jsx)(o.A,{span:24,children:(0,q.jsx)(n.A.Item,{label:t("products"),name:"products",rules:[{required:!0,message:t("required")}],children:(0,q.jsx)(j.G,{fetchOptions:async function(e){const l={search:e,shop_id:V.id,status:"published",active:1,rest:1};return D.A.getAll(l).then((e=>e.data.map((e=>{var l,a,s,i;return{label:`${null===e||void 0===e||null===(l=e.product)||void 0===l||null===(a=l.translation)||void 0===a?void 0:a.title} => ${null===e||void 0===e||null===(s=e.extras)||void 0===s||null===(i=s.map((e=>{var l,a,s,i,n;return`${(null===e||void 0===e||null===(l=e.group)||void 0===l||null===(a=l.translation)||void 0===a?void 0:a.title)||t("N/A")}: ${"color"===(null===e||void 0===e||null===(s=e.group)||void 0===s?void 0:s.type)?(0,N.n)(null===e||void 0===e||null===(i=e.value)||void 0===i?void 0:i.value):(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.value)||t("N/A")}`})))||void 0===i?void 0:i.join(", ")}`,value:e.id,key:e.id}}))))},mode:"multiple"})})}),(0,q.jsx)(o.A,{span:24,children:(0,q.jsx)(n.A.Item,{label:t("image"),name:"images",rules:[{required:!z.length,message:t("required")}],children:(0,q.jsx)(b.A,{type:"discounts",imageList:z,setImageList:E,form:w,multiple:!1,name:"image"})})})]}),(0,q.jsx)("div",{className:"flex-grow-1 d-flex flex-column justify-content-end",children:(0,q.jsx)("div",{className:"pb-5",children:(0,q.jsx)(m.A,{type:"primary",htmlType:"submit",loading:O,children:t("submit")})})})]})})}},8002:(e,l,t)=>{t.d(l,{A:()=>s});var a=t(82371);const s={getAll:e=>a.A.get("dashboard/seller/stocks/select-paginate",{params:e})}},47992:(e,l,t)=>{t.d(l,{G:()=>o});var a=t(9950),s=t(95491),i=t.n(s),n=t(99674),d=t(90650),r=t(44414);const o=e=>{let{fetchOptions:l,debounceTimeout:t=400,onClear:s,refetchOptions:o=!1,...u}=e;const[c,v]=(0,a.useState)(!1),[m,p]=(0,a.useState)([]),h=(0,a.useMemo)((()=>i()((e=>{p([]),v(!0),l(e).then((e=>{p(e),v(!1)}))}),t)),[l,t]);return(0,r.jsx)(n.A,{showSearch:!0,allowClear:!0,labelInValue:!0,filterOption:!1,onSearch:h,onClear:()=>{h(""),s&&s()},notFoundContent:c?(0,r.jsx)(d.A,{size:"small"}):"no results",...u,options:m,onFocus:()=>{m.length&&!o||h("")}})}}}]);